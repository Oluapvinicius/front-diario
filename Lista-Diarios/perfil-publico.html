<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Público - Diário de Viagens</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="./home-principal.css">
    <link rel="stylesheet" href="./perfil.css">
</head>
<body class="main-body">
    <header class="diary-header">
        <div class="header-left">
            <button class="icon-btn" onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="header-logo">
                <i class="fas fa-user-circle"></i>
                Perfil Público
            </div>
        </div>
    </header>

    <div class="profile-container">
        <div class="profile-header-info">
            <div class="profile-pic-large" id="profile-pic-area">
                <i class="fas fa-user" style="font-size: 3rem; color: #ccc;"></i>
            </div>
            <div class="user-details">
                <h2 id="profile-username">Carregando...</h2>
                <p id="profile-bio">Carregando descrição...</p>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-value" id="stat-followers">0</div>
                        <div class="stat-label">Seguidores</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-trips">0</div>
                        <div class="stat-label">Viagens</div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="btn-follow" id="btn-follow" onclick="toggleFollow(this)">Seguir</button>
                </div>
            </div>
        </div>
        <h3 class="profile-section-title">Postagens Públicas</h3>
        <div class="gallery-grid" id="gallery"></div>
    </div>

    <script>
        async function loadProfileData() {
            const profileUserId = localStorage.getItem('selectedUserId') || localStorage.getItem('userId');
            
            if (!profileUserId) {
                window.location.href = "../index.html";
                return;
            }

            try {
                const responseUsuario = await fetch(`http://localhost:8080/v1/travel/usuario/${profileUserId}`);
                const dataUsuario = await responseUsuario.json();
                
                if (dataUsuario.status_code !== 200) {
                    console.error("Usuário não encontrado");
                    return;
                }
                
                const usuario = dataUsuario.response;
                
                document.getElementById('profile-username').textContent = usuario.user_nome || usuario.nome;
                document.getElementById('profile-bio').textContent = usuario.descricao || "Sem descrição";
                document.getElementById('stat-followers').textContent = usuario.quantidade_seguidores || 0;
                
                const responseViagens = await fetch('http://localhost:8080/v1/travel/viagem');
                const dataViagens = await responseViagens.json();
                
                let viagensDoUsuario = [];
                if (dataViagens.status_code === 200 && dataViagens.response.viagens) {
                    viagensDoUsuario = dataViagens.response.viagens.filter(v => 
                        v.id_usuario == profileUserId && (v.isPublico === true || v.isPublico === 1)
                    );
                }
                
                document.getElementById('stat-trips').textContent = viagensDoUsuario.length;
                exibirImagens(viagensDoUsuario);
                
            } catch (error) {
                console.error("Erro ao carregar perfil:", error);
            }
        }

        function exibirImagens(listaViagens) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';

            if (!listaViagens || listaViagens.length === 0) {
                const p = document.createElement('p');
                p.style.color = 'var(--secondary-text)';
                p.textContent = 'Nenhuma postagem pública disponível.';
                gallery.appendChild(p);
                return;
            }

            listaViagens.forEach(viagem => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.onclick = () => abrirModal(viagem);

                const img = document.createElement('img');
                img.src = `https://via.placeholder.com/400x300?text=${encodeURIComponent(viagem.nome)}`;
                img.alt = viagem.titulo;

                galleryItem.appendChild(img);
                gallery.appendChild(galleryItem);
            });
        }

        function abrirModal(viagem) {
            alert(`Viagem: ${viagem.nome}\nDescrição: ${viagem.descricao || 'Sem descrição'}`);
        }

        function toggleFollow(btn) {
            if (btn.textContent === 'Seguir') {
                btn.textContent = 'Seguindo';
                btn.style.backgroundColor = '#ccc';
                btn.style.color = '#333';
            } else {
                btn.textContent = 'Seguir';
                btn.style.backgroundColor = 'var(--primary)';
                btn.style.color = '#fff';
            }
        }

        document.addEventListener('DOMContentLoaded', loadProfileData);
    </script>
</body>
</html>