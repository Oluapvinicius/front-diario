<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed de Postagens Públicas</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="stylesheet" href="./home-principal.css">
    <link rel="stylesheet" href="./feed-publico.css"> 
</head>
<body class="main-body">

    <header class="diary-header">
        <div class="header-left">
            <button class="icon-btn" onclick="voltaTela()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="header-logo">
                Feed de Viagens
            </div>
        </div>
        
        <div class="main-search-row" style="margin:0; width: 400px; max-width: 50%;">
            <input 
                type="text" 
                id="search-input"
                class="form-input main-search-input" 
                placeholder="Buscar viagem ou usuário..." 
                oninput="filtrarFeed()"
            />
            <button class="icon-btn search-align-center" style="margin-left: -50px;" onclick="filtrarFeed()">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <div class="header-right">
            <button class="icon-btn">
                <i class="fas fa-bell"></i>
            </button>
            <button class="icon-btn profile-icon">
                <i class="fas fa-user-circle"></i>
            </button>
        </div>
    </header>

    <div class="feed-main-content" id="public-feed-container">
    </div>

    <script>
        function voltaTela() {
            window.location.href = './home-principal.html';
        }

        const publicPosts = [
            {
                "id_viagem": 101,
                "nome_viagem": "Museu Histórico de SP",
                "descricao_viagem": "Uma tarde incrível explorando as exposições de arte e história da cidade.",
                "data_inicio": "20/JAN",
                "dia_semana": "SEG",
                "horario": "15:00",
                "local_resumo": "São Paulo, Brasil",
                "isPublico": true,
                "usuario": {
                    "id_usuario": 1,
                    "user_nome": "Carla Oliveira",
                    "foto_perfil_url": "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop" 
                },
                "imagem_url": "https://images.unsplash.com/photo-1550586678-f7225f03c44b?w=500&h=300&fit=crop"
            },
            {
                "id_viagem": 102,
                "nome_viagem": "Trilha da Cachoeira Escondida",
                "descricao_viagem": "Um dia de aventura na natureza, descobrindo uma cachoeira secreta.",
                "data_inicio": "12/NOV",
                "dia_semana": "DOM",
                "horario": "10:30",
                "local_resumo": "Chapada Diamantina, Bahia",
                "isPublico": true,
                "usuario": {
                    "id_usuario": 2,
                    "user_nome": "Lucas Ferreira",
                    "foto_perfil_url": "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop"
                },
                "imagem_url": "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=500&h=300&fit=crop"
            },
            {
                "id_viagem": 103,
                "nome_viagem": "Férias em Paris",
                "descricao_viagem": "Visitando a Torre Eiffel e comendo croissants.",
                "data_inicio": "05/MAR",
                "dia_semana": "QUA",
                "horario": "14:00",
                "local_resumo": "Paris, França",
                "isPublico": true,
                "usuario": {
                    "id_usuario": 1,
                    "user_nome": "Carla Oliveira",
                    "foto_perfil_url": "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop" 
                },
                "imagem_url": "https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=500&h=300&fit=crop"
            }
        ];

        function entrarPerfil(idUsuario) {
            localStorage.setItem('selectedUserId', idUsuario);
            window.location.href = "./perfil-publico.html";
        }

        function createPostCard(post) {
            const card = document.createElement('div');
            card.className = 'post-card';
       
            const userHeaderFeed = document.createElement('div');
            userHeaderFeed.className = 'user-header-feed';

            const profilePicFeed = document.createElement('div');
            profilePicFeed.className = 'profile-pic-feed';
            profilePicFeed.onclick = () => entrarPerfil(post.usuario.id_usuario);
            profilePicFeed.style.cursor = 'pointer';

            const profileImg = document.createElement('img');
            profileImg.src = post.usuario.foto_perfil_url;
            profileImg.alt = post.usuario.user_nome.charAt(0);

            profilePicFeed.appendChild(profileImg);

            const usernameFeed = document.createElement('span');
            usernameFeed.className = 'username-feed';
            usernameFeed.onclick = () => entrarPerfil(post.usuario.id_usuario);
            usernameFeed.style.cursor = 'pointer';
            usernameFeed.textContent = post.usuario.user_nome;

            userHeaderFeed.appendChild(profilePicFeed);
            userHeaderFeed.appendChild(usernameFeed);
            card.appendChild(userHeaderFeed);

            const postBodyFeed = document.createElement('div');
            postBodyFeed.className = 'post-body-feed';

            const postDateFeed = document.createElement('div');
            postDateFeed.className = 'post-date-feed';

            const dayName = document.createElement('div');
            dayName.className = 'day-name';
            dayName.textContent = post.dia_semana;

            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = post.data_inicio.split('/')[0];

            postDateFeed.appendChild(dayName);
            postDateFeed.appendChild(dayNumber);

            const postContentFeed = document.createElement('div');
            postContentFeed.className = 'post-content-feed';

            const tripMediaFeed = document.createElement('div');
            tripMediaFeed.className = 'trip-media-feed';

            const mediaImg = document.createElement('img');
            mediaImg.src = post.imagem_url;
            mediaImg.alt = post.nome_viagem;

            tripMediaFeed.appendChild(mediaImg);

            const title = document.createElement('h2');
            title.className = 'title';
            title.textContent = post.nome_viagem;

            const description = document.createElement('p');
            description.className = 'description';
            description.textContent = post.descricao_viagem;

            const postFooterFeed = document.createElement('div');
            postFooterFeed.className = 'post-footer-feed';

            const locationDiv = document.createElement('div');
            locationDiv.className = 'location';

            const mapIcon = document.createElement('i');
            mapIcon.className = 'fas fa-map-marker-alt';

            const locationSpan = document.createElement('span');
            locationSpan.textContent = `${post.horario} | ${post.local_resumo}`;

            locationDiv.appendChild(mapIcon);
            locationDiv.appendChild(locationSpan);

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'actions';

            const heartIcon = document.createElement('i');
            heartIcon.className = 'far fa-heart';
            heartIcon.title = 'Curtir';

            const starIcon = document.createElement('i');
            starIcon.className = 'far fa-star';
            starIcon.title = 'Favoritar';

            actionsDiv.appendChild(heartIcon);
            actionsDiv.appendChild(starIcon);

            postFooterFeed.appendChild(locationDiv);
            postFooterFeed.appendChild(actionsDiv);

            postContentFeed.appendChild(tripMediaFeed);
            postContentFeed.appendChild(title);
            postContentFeed.appendChild(description);
            postContentFeed.appendChild(postFooterFeed);

            postBodyFeed.appendChild(postDateFeed);
            postBodyFeed.appendChild(postContentFeed);
            card.appendChild(postBodyFeed);

            return card;
        }

        function filtrarFeed() {
            const termoBusca = document.getElementById('search-input').value.toLowerCase();

            const postsFiltrados = publicPosts.filter(post => {
                const nomeViagem = post.nome_viagem.toLowerCase();
                const nomeUsuario = post.usuario.user_nome.toLowerCase();

                return nomeViagem.includes(termoBusca) || nomeUsuario.includes(termoBusca);
            });

            renderFeed(postsFiltrados);
        }

        function renderFeed(listaPosts = publicPosts) {
            const feedContainer = document.getElementById('public-feed-container');
            feedContainer.innerHTML = ''; 

            if (listaPosts.length === 0) {
                const div = document.createElement('div');
                div.style.textAlign = 'center';
                div.style.marginTop = '50px';
                div.style.color = 'var(--secondary-text)';
                
                const icon = document.createElement('i');
                icon.className = 'fas fa-search';
                icon.style.fontSize = '2rem';
                icon.style.marginBottom = '15px';
                icon.style.opacity = '0.5';

                const p = document.createElement('p');
                p.textContent = 'Nenhuma viagem ou usuário encontrado.';

                div.appendChild(icon);
                div.appendChild(p);
                feedContainer.appendChild(div);
                return;
            }

            listaPosts.forEach(post => {
                if (post.isPublico) { 
                    const postCard = createPostCard(post);
                    feedContainer.appendChild(postCard);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderFeed(publicPosts);
        });
    </script>
</body>
</html>